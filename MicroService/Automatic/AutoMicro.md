
<!--- toc --->

# 自动化微服务拆分

#microservice #clang 

## 定位

为已经构建完成不希望改动范围大的单体应用提供简便的自动化拆分工具，对云计算领域并不熟悉的单体应用开发者能够轻松使用。

本项目现阶段针对使用C++面向对象开发的单体应用改造，面向Java等其余面向对象语言的单体应用可能使用其他的技术路线有更好的效果。

因开发时间有限，本项目采取简化问题的处理方式，使用最易的实现方式。

## 形式

### 项目目录架构

为简便实现，本项目主要采用Python，遵照Python项目的结构。

- `config`: 项目面向配置，包含微服务拆分的指导配置
	- `.clang-format`: 采用Google Code Style，将用户原C++工程格式重构，利用这种方式省去利用clang编译器重构项目的必要性
	- `architecture`: 本项目将设计新的语言或者使用json等描述文件刻画用户的微服务组织架构图，项目运行将以此作为重要参考
	- `tree_module_map`: 表明文件树中文件夹所代表的模块名，模块都应在微服务`architecture`中得到体现
	- `tutorial.md`: 该教程为组织架构图的描述语言介绍
- `micro_service_app`: 生成的微服务程序
- `raw_app`: 用户源代码，需要用户在源码中添加编译制导指令`#pragma ms`来指导本项目生成分布式共享数据库
	- `tutorial.md`: 微服务编译制导指令的格式与介绍
- `source_libs`: 包含已写好可直接搬运使用的微服务源码
- `src`: 项目源代码主目录
- `requirements.txt`: 依赖包安装
- `setup.py`: 项目安装

### 微服务项目组织架构图描述语言

欲描述一个微服务项目的组织架构图，需要明确相关的定义：

- `API Server`: 作为用户使用微服务的接口，负责与单用户流程的主节点通信
- `Node`: 以docker为单位的节点，为调度和微服务基本单位
	- `Components`: `Node`由组件`Components`构成，组件有三种：
		- `inNode`为不与外界交互的逻辑模块，只对内提供服务
		- `Server`为向外界提供服务的模块
		- `Client`为请求外界服务的模块
	- `Functions`: `Node`有特定功能，后两者可与前三者组合
		- `File`为文件处理节点
		- `Calculate`为计算节点
		- `Passer`为中间数据处理、传递节点
		- `Master`可以是全局主节点，也能够是特定任务的局部主节点，全局主节点仅能有一个
		- `Child`为承担并行任务的子节点
- `Layer`: 当若干`Node`运行不存在冲突时，可并行运行，则可在同一`Layer`
- `RequestEdge`: 当存在一个`Node`的`Client Component`对另一个`Node`的`Server Component`有动作请求，则使用`RequestEdge`表明这种关系。不需要`ResponseEdge`，因为请求必被允许，可以理解为若两`Node`之间存在有向边`Edge`，则方向代表请求。`RequestEdge`落到`Components`

在明确上述定义之后便可以书写组织架构图了。

yaml
json

### 项目树-模块映射

需要将`architecture`中出现的模块名与项目树中的文件夹对应映射。

一个常见的C++

### 编译制导指令格式

本项目使用编译制导指令对源代码进行解读和改造，针对C++面向对象的程序，存在一些单体应用的开发建议，遵循此开发建议可使用本工具进行快速开发，否则需要人工进行一些程序正确性检查。



<!--- endtoc --->